---
title: "Recreating the GBM meta-programs"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Tutorial}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(collapse=FALSE,
		      comment="#>", 
		      warning=FALSE, 
		      message=FALSE, 
		      error=TRUE)
options(tibble.print_min=4L,
	tibble.print_max=4L)
knitr::opts_knit$set(warning=FALSE,
		     message=FALSE,
		     error=TRUE)
library(magrittr)
set.seed(1014)
```

### 1 Load data
```{r}
?scalop::MGH136
head(scalop::MGH136[,1:6])
```

### 2 Center expression matrix
```{r}
MGH136.cent = scalop::rowcenter(scalop::MGH136)
```

```{r, eval=FALSE}
"""
MGH136.cent = t(scale(t(MGH136),center=T, scale=F))
# Or with sweep, apply, etc.
"""
```

### 3 Generate an ordered correlation matrix
```{r}	
cr.matrix = scalop::hca_cor(MGH136.cent)
```

```{r, eval=FALSE}
"""
cr.matrix = scalop::hca_cor(MGH136.cent)
dist.matrix = as.dist(1-cr.matrix)
tree = hclust(dist.matrix)
cell.order = tree$order
cr.matrix = cr.matrix[cell.order, cell.order]
"""
```

### 4 Retrieve cell clusters with a specified *k*
```{r}
clusters_4 = scalop::hca_groups(
				cr.matrix,
				k=4,
				cor.method='none',
				min.size=0,
				max.size=1
)

```
```{r, eval=FALSE}
"""
clusters_4 = stats::cutree(tree = tree, k = 4)
"""
```

### 5 Define expression programs from each cell cluster

<a href="https://github.com/jlaffy/scalop/img/DEA.pdf"><img

```{r}
programs_all = scalop::dea(MGH136.cent,
			   group=clusters_4,
			   center.rows=FALSE)

# ==========================
# Arguments (default values)
# ==========================
# lfc = log2(2) (or NULL)
# p = 0.01 (or NULL)
# pmethod = “BH”
# arrange.by = ‘lfc’ (or ‘p’)
# return.val = ‘lfc’ (or ‘p’ or  ‘gene’)
```


#### 1.6. (*Revisiting 1.4.*)Retrieve cell clusters with no cutoff.
```{r}
```

### 2. MGH136 expression programs the real deal 

### Define expression programs from all tumours

#### Cluster expression programs

### MSigDB gene set functional enrichments
